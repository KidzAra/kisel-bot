# Kisel Bot - Менеджер друзей для Discord

Discord бот, созданный с использованием библиотеки disnake, который позволяет пользователям управлять своими списками друзей и легко приглашать друзей в голосовые каналы.

## Возможности

- Добавление друзей в персональный список
- Удаление друзей из списка
- Просмотр текущего списка друзей
- Отправка приглашений в голосовой чат всем друзьям одновременно
- Сохранение данных даже после перезапуска бота

## Команды

- `/friendhelp` - Показывает справку по всем командам
- `/addfriend [пользователь]` - Добавляет пользователя в ваш список друзей
- `/removefriend` - Открывает меню для выбора и удаления друга
- `/friendlist` - Показывает ваш текущий список друзей
- `/callvoice` - Отправляет уведомление о голосовом вызове всем вашим друзьям

## Настройка

1. Установите зависимости:
```
pip install disnake
```

2. Создайте бота Discord на [Discord Developer Portal](https://discord.com/developers/applications)
   - Создайте новое приложение
   - Перейдите на вкладку "Bot" и добавьте бота
   - Включите все привилегированные шлюзовые интенты (Presence Intent, Server Members Intent и Message Content Intent)
   - Скопируйте токен вашего бота

3. Настройте бота одним из двух способов:

   **Способ 1: Использование скрипта настройки (рекомендуется)**
   ```
   python setup.py
   ```
   Скрипт проведёт вас через процесс настройки, запросив токен бота и ID серверов.

   **Способ 2: Ручная настройка**
   - Скопируйте файл `config.py.example` в `config.py`
   - Замените `ВСТАВЬТЕ_ВАШ_ТОКЕН_СЮДА` на ваш токен бота
   - Для быстрой регистрации команд на конкретных серверах раскомментируйте и заполните список `GUILD_IDS`
   ```python
   # Пример настройки config.py
   TOKEN = "ваш_токен_бота_здесь"
   DATA_FILE = "friends_data.json"
   GUILD_IDS = [123456789, 987654321]  # ID ваших серверов
   ```

4. Запустите бота:
```
python bot.py
```

5. Пригласите бота на ваш сервер:
   - Перейдите в генератор URL OAuth2 на портале разработчиков
   - Выберите области "bot" и "applications.commands"
   - Выберите соответствующие разрешения бота (как минимум: Read Messages, Send Messages, Embed Links)
   - Используйте сгенерированный URL для добавления бота на ваш сервер

## Уведомление о голосовом вызове

При использовании команды `/callvoice` бот будет:
1. Отправлять личное сообщение всем друзьям из вашего списка
2. Включать кнопку "Войс", если вы находитесь в голосовом канале
3. При нажатии на кнопку пользователь будет перенаправлен в ваш голосовой канал

## Хранение данных

Списки друзей хранятся в файле `friends_data.json` в следующем формате:
```json
{
    "user_id": ["friend_id1", "friend_id2", ...]
}
```

## Требования

- Python 3.8 или выше
- Библиотека disnake

## Решение проблем

### Команды не появляются в Discord

Если команды не регистрируются в Discord, попробуйте следующее:

1. **Задержка регистрации:** Глобальная регистрация команд может занять до часа. Для быстрой регистрации на конкретных серверах используйте параметр `GUILD_IDS` в файле `config.py`.

2. **Права бота:** Убедитесь, что бот имеет право "applications.commands" при приглашении на сервер.

3. **Интенты Discord:** В настройках бота на портале разработчика Discord включите все привилегированные интенты (Presence Intent, Server Members Intent, Message Content Intent).

4. **Статус регистрации:** После запуска бот покажет отладочную информацию о регистрации команд. Убедитесь, что нет ошибок.

### Предупреждения при запуске бота

Если вы видите предупреждения вроде "dm_permission is deprecated", не беспокойтесь - бот будет работать нормально. Это связано с обновлениями в библиотеке disnake, где некоторые параметры были заменены на более новые. В последних версиях кода эти предупреждения исправлены использованием параметра `contexts` вместо `dm_permission`. 